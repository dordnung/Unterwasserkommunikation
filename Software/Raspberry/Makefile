SRC_TRANSMITTER = test_transmitter.c 
SRC_RECEIVER = test_receiver.c
TARGET_TRANSMITTER = test_transmitter
TARGET_RECEIVER = test_receiver

CC = gcc
CFLAGS = -Wall -Werror -pthread
LDLIBS = -lultrasonic_communication -lpigpio -lm -lrt

OBJ_TRANSMITTER = $(SRC_TRANSMITTER:.c=.o)
OBJ_RECEIVER = $(SRC_RECEIVER:.c=.o)
DEP = $(SRC_TRANSMITTER:.c=.d) $(SRC_RECEIVER:.c=.d)

.PHONY: all clean

# Default targets as it is the first target
# Not really required, but always good to have
all: $(TARGET_TRANSMITTER) $(TARGET_RECEIVER)

# 1. Link the targets
$(TARGET_TRANSMITTER): $(OBJ_TRANSMITTER) Makefile
	$(CC) $(CFLAGS) -o $@ $(OBJ_TRANSMITTER) $(LDLIBS)

$(TARGET_RECEIVER): $(OBJ_RECEIVER) Makefile
	$(CC) $(CFLAGS) -o $@ $(OBJ_RECEIVER) $(LDLIBS)

# 2. Build the sources
%.o: %.c Makefile
	$(CC) -MMD $(CFLAGS) -c -o $@ $<

# 3. Clean autogenerated stuff
clean:
	$(RM) $(OBJ_TRANSMITTER) $(OBJ_RECEIVER) $(DEP) $(TARGET_TRANSMITTER) $(TARGET_RECEIVER)

# Include the dependencies
-include $(DEP)